These are the utility functions for version 3